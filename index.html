<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mobile OTP Login</title>
<style>
body {
  font-family: Arial;
  background: #f2f2f2;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.container {
  background: #fff;
  padding: 25px;
  border-radius: 8px;
  width: 320px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
}
input {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border: 1px solid #ccc;
  border-radius: 5px;
}
button {
  width: 100%;
  padding: 12px;
  background: #0066ff;
  color: #fff;
  font-size: 16px;
  border: none;
  cursor: pointer;
  margin-top: 5px;
  border-radius: 5px;
}
#otp-box {
  display: none;
}
</style>
</head>
<body>

<div class="container">
    <h3>Mobile OTP Login</h3>

    <input type="text" id="phone" placeholder="Enter Mobile Number (e.g. +91xxxxxxxxxx)">
    <div id="recaptcha-container"></div>
    <button onclick="sendOTP()">Send OTP</button>

    <div id="otp-box">
        <input type="text" id="otp" placeholder="Enter OTP">
        <button onclick="verifyOTP()">Verify OTP</button>
    </div>
</div>

<!-- Firebase Config -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { 
  getAuth, 
  RecaptchaVerifier, 
  signInWithPhoneNumber 
} from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD9IrRF15IfzYEfwQTl_JA_ie4SyaPCUfU",
  authDomain: "otp-login-form-e13e2.firebaseapp.com",
  projectId: "otp-login-form-e13e2",
  storageBucket: "otp-login-form-e13e2.firebasestorage.app",
  messagingSenderId: "345706715094",
  appId: "1:345706715094:web:d0fd55ebe741ea1871b677"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Recaptcha Setup
window.recaptchaVerifier = new RecaptchaVerifier(
  auth,
  "recaptcha-container",
  {
    size: "normal",
  }
);

// Send OTP
window.sendOTP = function () {
  const phone = document.getElementById("phone").value;
  if (phone.length < 10) return alert("Enter valid phone number");

  signInWithPhoneNumber(auth, phone, window.recaptchaVerifier)
    .then((confirmationResult) => {
      window.confirmationResult = confirmationResult;
      alert("OTP Sent!");
      document.getElementById("otp-box").style.display = "block";
    })
    .catch((error) => {
      alert(error.message);
    });
}

// Verify OTP
window.verifyOTP = function () {
  const otp = document.getElementById("otp").value;
  confirmationResult.confirm(otp)
    .then((result) => {
      alert("‚úÖ Login Successful");
      console.log("User:", result.user);
    })
    .catch((error) => {
      alert("‚ùå Invalid OTP");
    });
}
</script>

</body>
</html>  <div class="wallet">
    <h3>Wallet Balance: ‚Çπ<span id="walletBalance">0</span></h3>
  </div>
  <div class="tasks">
    <h4>Tasks Available</h4>
    <div onclick="completeTask(10)">üìù Survey Form ‚Äì ‚Çπ10</div>
    <div onclick="completeTask(15)">üì∏ Upload Image ‚Äì ‚Çπ15</div>
    <div onclick="completeTask(20)">üé• Watch Video ‚Äì ‚Çπ20</div>
  </div>
</div>

<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCX036WRMWoiH0acazsLE8o-JWlOQQiByY",
    authDomain: "otp-login-6c7bf.firebaseapp.com",
    projectId: "otp-login-6c7bf",
    storageBucket: "otp-login-6c7bf.firebasestorage.app",
    messagingSenderId: "1091262594139",
    appId: "1:1091262594139:web:4a7295747c3f7134d5937e"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  auth.languageCode = "en";

  const sendOtpBtn = document.getElementById('sendOtpBtn');
  const verifyOtpBtn = document.getElementById('verifyOtpBtn');
  const otpDiv = document.getElementById('otpDiv');
  const timerText = document.getElementById('timerText');
  const resendBtn = document.getElementById('resendBtn');
  let confirmationResult;

  window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
    'size': 'invisible'
  });

  sendOtpBtn.onclick = async () => {
    const phoneNumber = "+91" + document.getElementById('phoneNumber').value.trim();
    if (phoneNumber.length < 13) return alert("Enter valid 10-digit number");
    try {
      confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, window.recaptchaVerifier);
      otpDiv.style.display = 'block';
      sendOtpBtn.style.display = 'none';
      startTimer();
      alert("OTP sent successfully!");
    } catch (error) {
      console.error(error);
      alert("Error: " + error.message);
    }
  };

  verifyOtpBtn.onclick = async () => {
    const otpInputs = document.querySelectorAll('.otp-input input');
    const otp = Array.from(otpInputs).map(i => i.value).join('');
    if (otp.length !== 6) return alert("Enter 6-digit OTP");
    try {
      await confirmationResult.confirm(otp);
      document.getElementById('loginDiv').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      alert("Login Successful!");
    } catch (error) {
      alert("Invalid OTP");
    }
  };

  function startTimer() {
    let time = 180; // 3 minutes
    resendBtn.style.display = 'none';
    const timer = setInterval(() => {
      if (time <= 0) {
        clearInterval(timer);
        timerText.innerText = "Time expired!";
        resendBtn.style.display = 'block';
      } else {
        const min = Math.floor(time / 60);
        const sec = time % 60;
        timerText.innerText = `Resend available in ${min}:${sec < 10 ? "0" + sec : sec}`;
        time--;
      }
    }, 1000);
  }

  resendBtn.onclick = () => {
    resendBtn.style.display = 'none';
    document.getElementById('sendOtpBtn').click();
  };

  // Wallet demo
  let walletBalance = 0;
  window.completeTask = function(amount) {
    walletBalance += amount;
    document.getElementById('walletBalance').innerText = walletBalance;
    alert(`Task Completed! ‚Çπ${amount} added to wallet.`);
  };
</script>
</body>
</html>
