<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task Management Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
    /* VARIABLES - LIGHT MODE DEFAULT */
    :root {
        --primary: #4361ee;
        --primary-dark: #3a0ca3;
        --secondary: #7209b7;
        --success: #4ade80;
        --warning: #ff9e00;
        --info: #4cc9f0;
        --danger: #dc3545;
        --dark: #2b2d42;
        --light: #f8f9fa;
        --gray: #6c757d;
        --card-bg: rgba(255,255,255,.95);
        --shadow: 0 10px 30px rgba(0,0,0,.08);
        --text-primary: #2b2d42;
        --text-secondary: #6c757d;
        --border-color: #e9ecef;
        --sidebar-bg: white;
        --sidebar-text: #2b2d42;
        --table-header-bg: #f8f9fa;
        --table-border: #e9ecef;
        --gradient-primary: linear-gradient(135deg, #4361ee, #3a0ca3);
        --gradient-warning: linear-gradient(135deg, #ff9e00, #ff6b00);
        --gradient-info: linear-gradient(135deg, #4cc9f0, #4895ef);
        --gradient-success: linear-gradient(135deg, #4ade80, #22c55e);
        --gradient-secondary: linear-gradient(135deg, #7209b7, #560bad);
        --whatsapp: #25D366;
        --body-bg: linear-gradient(135deg, #667eea, #764ba2);
    }
    /* TOP BAR FIX */
.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    border-radius: 50px;
    padding: 12px 25px;
    margin-bottom: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.menu-toggle {
    background: var(--primary);
    border: none;
    color: white;
    font-size: 18px;
    padding: 12px 15px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: static; /* Remove absolute positioning */
}

.menu-toggle:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}

.logout-btn {
    background: var(--gradient-secondary);
    border: none;
    color: white;
    padding: 10px 18px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    position: static; /* Remove absolute positioning */
}

.logout-btn:hover {
    transform: scale(1.05);
}

    /* DARK MODE VARIABLES */
    [data-theme="dark"] {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --secondary: #8b5cf6;
        --success: #10b981;
        --warning: #f59e0b;
        --info: #06b6d4;
        --danger: #ef4444;
        --dark: #f8f9fa;
        --light: #1f2937;
        --gray: #9ca3af;
        --card-bg: rgba(31, 41, 55, 0.95);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        --text-primary: #f8f9fa;
        --text-secondary: #d1d5db;
        --border-color: #374151;
        --sidebar-bg: #111827;
        --sidebar-text: #f8f9fa;
        --table-header-bg: #374151;
        --table-border: #4b5563;
        --gradient-primary: linear-gradient(135deg, #6366f1, #4f46e5);
        --gradient-warning: linear-gradient(135deg, #f59e0b, #d97706);
        --gradient-info: linear-gradient(135deg, #06b6d4, #0891b2);
        --gradient-success: linear-gradient(135deg, #10b981, #059669);
        --gradient-secondary: linear-gradient(135deg, #8b5cf6, #7c3aed);
        --body-bg: linear-gradient(135deg, #1e3a8a, #3730a3);
    }
    
    /* BASE STYLES */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
    }
    
    body {
        background: var(--body-bg);
        min-height: 100vh;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        overflow-x: hidden;
        transition: all 0.3s ease;
        color: var(--text-primary);
    }
    
    body.lock-scroll {
        overflow: hidden;
    }
    
    .dashboard {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border-radius: 24px;
        padding: 30px;
        box-shadow: var(--shadow);
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        border: 1px solid var(--border-color);
        position: relative;
        transition: all 0.3s ease;
    }
    
    
    /* IMPROVED SIDE DRAWER */
    .side-drawer {
        position: fixed;
        top: 0;
        left: -320px;
        width: 320px;
        height: 100vh;
        background: var(--sidebar-bg);
        box-shadow: 5px 0 25px rgba(0, 0, 0, 0.15);
        transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1001;
        padding: 0;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        border-radius: 0 20px 20px 0;
        transition: all 0.3s ease;
    }

    .side-drawer.open {
        left: 0;
    }

    .drawer-header {
        background: var(--gradient-primary);
        padding: 30px 25px;
        color: white;
        position: relative;
    }

    .drawer-close {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255,255,255,0.2);
        border: none;
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .drawer-close:hover {
        background: rgba(255,255,255,0.3);
        transform: rotate(90deg);
    }

    .user-profile {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        text-align: center;
    }

    .avatar-container {
        position: relative;
        width: 100px;
        height: 100px;
    }

    .user-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: rgba(255,255,255,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2rem;
        font-weight: bold;
        border: 3px solid rgba(255,255,255,0.3);
        overflow: hidden;
    }

    .user-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .avatar-upload {
        position: absolute;
        bottom: 0;
        right: 0;
        background: var(--primary);
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 0.8rem;
        border: 2px solid white;
    }

    .user-info h3 {
        color: white;
        font-size: 1.2rem;
        margin-bottom: 5px;
        font-weight: 600;
        text-align: center;
    }

    .user-info p {
        color: rgba(255,255,255,0.8);
        font-size: 0.85rem;
        text-align: center;
    }

    .drawer-content {
        padding: 25px;
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--sidebar-bg);
        transition: all 0.3s ease;
    }

    .drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        z-index: 1000;
        display: none;
        transition: all 0.3s ease;
    }

    .drawer-overlay.show {
        display: block;
    }

    .drawer-item {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 15px;
        padding: 16px 20px;
        border-radius: 12px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--sidebar-text);
        text-decoration: none;
        min-height: 54px;
        border: 1px solid transparent;
        width: 100%;
        text-align: left;
        background: transparent;
    }

    .drawer-item.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
        box-shadow: 0 4px 15px rgba(67, 97, 238, 0.2);
    }

    .drawer-item:hover:not(.active) {
        background: var(--light);
        transform: translateX(5px);
        border-color: var(--border-color);
    }

    .drawer-item i {
        font-size: 1.3rem;
        color: var(--primary);
        width: 24px;
        text-align: center;
        transition: all 0.3s ease;
        flex-shrink: 0;
    }

    .drawer-item.active i {
        color: white;
    }

    .drawer-item span {
        flex-grow: 1;
        text-align: center;
        font-weight: 500;
        color: inherit;
    }

    .drawer-section {
        margin: 25px 0 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
        color: var(--gray);
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        text-align: center;
    }

    .drawer-footer {
        margin-top: auto;
        padding: 20px;
        border-top: 1px solid var(--border-color);
        text-align: center;
        background: var(--sidebar-bg);
        transition: all 0.3s ease;
    }

    .whatsapp-btn {
        background: var(--whatsapp);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 100%;
        margin-bottom: 15px;
    }

    .whatsapp-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
    }

    .contact-info {
        font-size: 0.85rem;
        color: var(--gray);
        margin-top: 10px;
        text-align: center;
    }

    .contact-info strong {
        color: var(--sidebar-text);
    }

    /* BUTTONS & TOGGLES */
    .btn, .logout-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all .3s ease;
        font-size: .9rem;
        white-space: nowrap;
        min-height: 44px;
    }
    
    
    .logout-btn:hover, .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(67,97,238,.4);
    }
    
    .btn-primary {
        background: var(--gradient-primary);
        color: white;
        box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
    }
    
    .btn-secondary {
        background: var(--card-bg);
        color: var(--primary);
        border: 1px solid var(--border-color);
    }
    
    .btn-secondary:hover {
        background: var(--light);
        transform: translateY(-2px);
    }
    
    .btn-outline {
        background: transparent;
        color: var(--primary);
        border: 1px solid var(--primary);
    }
    
    .btn-outline:hover {
        background: var(--primary);
        color: white;
    }
    
    .toggle-btn {
        padding: 8px 16px;
        border: 1px solid var(--border-color);
        background: var(--card-bg);
        border-radius: 8px;
        cursor: pointer;
        transition: all .3s ease;
        font-weight: 500;
        min-height: auto;
        color: var(--text-primary);
    }
    
    .toggle-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }
    
    /* HEADER & FILTERS */
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 0;
    }
    
    .header-left {
        flex: 0 0 45%;
    }
    
    .header-center {
        flex: 1;
        text-align: center;
        min-width: 300px;
    }
    
    .header-right {
        flex: 0 0 45%;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    
    .current-time {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--text-primary);
    }
    
    .current-date {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .header-title h1 {
        color: var(--text-primary);
        margin-bottom: 5px;
        font-size: 1.8rem;
    }
    
    .header-title p {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    
    /* IMPROVED SEARCH CONTAINER */
    .search-container {
        position: relative;
        display: flex;
        gap: 10px;
        margin-top: 15px;
        width: 100%;
        max-width: 500px;
        margin: 15px auto 0 auto;
    }
    
    .search-input {
        flex: 1;
        padding: 12px 50px 12px 15px;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        font-size: .9rem;
        transition: all .3s ease;
        background: var(--card-bg);
        color: var(--text-primary);
    }
    
    .search-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
    
    .search-button-inside {
        position: absolute;
        right: 5px;
        top: 50%;
        transform: translateY(-50%);
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .search-button-inside:hover {
        transform: translateY(-50%) scale(1.05);
        background: var(--primary-dark);
    }
    
    .search-button-inside i {
        font-size: 1rem;
    }
    
    .date-filters {
        display: none;
        gap: 15px;
        flex-wrap: wrap;
        background: var(--light);
        padding: 20px;
        border-radius: 12px;
        margin-top: 15px;
        border: 1px solid var(--border-color);
        justify-content: center;
    }
    
    .date-filters.show {
        display: flex;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
        min-width: 150px;
    }
    
    .filter-label {
        font-weight: 500;
        color: var(--text-primary);
        font-size: 0.85rem;
    }
    
    select, input {
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: .9rem;
        background: var(--card-bg);
        color: var(--text-primary);
    }
    
    /* STATS GRID */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: var(--shadow);
        transition: transform .3s ease,box-shadow .3s ease;
        border-left: 4px solid;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        color: white!important;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,.1);
    }
    
    .stat-card.pending {
        border-left-color: var(--warning);
        background: var(--gradient-warning);
    }
    
    .stat-card.in-review {
        border-left-color: var(--info);
        background: var(--gradient-info);
    }
    
    .stat-card.completed {
        border-left-color: var(--success);
        background: var(--gradient-success);
    }
    
    .stat-card.earnings {
        border-left-color: var(--secondary);
        background: var(--gradient-secondary);
    }
    
    .stat-icon {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 1.8rem;
        opacity: .2;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: .9rem;
        opacity: .9;
        font-weight: 500;
    }
    
    .stat-total {
        font-size: .9rem;
        margin-top: 8px;
        font-weight: 600;
        opacity: .9;
    }
    
    /* CHARTS */
    .charts-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .chart-container {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 25px;
        box-shadow: var(--shadow);
        position: relative;
        transition: all 0.3s ease;
    }
    
    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .chart-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .chart-wrapper {
        height: 300px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .no-data-message {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        text-align: center;
        color: var(--gray);
        padding: 40px 20px;
    }
    
    .no-data-icon {
        font-size: 4rem;
        margin-bottom: 15px;
        color: var(--gray);
    }
    
    .no-data-text {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--text-primary);
    }
    
    .no-data-subtext {
        font-size: 0.9rem;
        color: var(--gray);
    }
    
    /* TASKS TABLE */
    .tasks-section {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 25px;
        box-shadow: var(--shadow);
        margin-bottom: 30px;
        overflow-x: auto;
        transition: all 0.3s ease;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .dashboard-actions {
        display: flex;
        gap: 10px;
    }
    
    .tasks-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px;
    }
    
    .tasks-table th {
        background: var(--table-header-bg);
        padding: 12px 15px;
        text-align: left;
        font-weight: 600;
        color: var(--text-primary);
        border-bottom: 2px solid var(--table-border);
    }
    
    .tasks-table td {
        padding: 12px 15px;
        border-bottom: 1px solid var(--table-border);
        vertical-align: top;
        color: var(--text-primary);
    }
    
    .task-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: .8rem;
        font-weight: 500;
        display: inline-block;
    }
    
    .status-pending {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-review {
        background: #e0f7fa;
        color: #006064;
    }
    
    .status-completed {
        background: #d1fae5;
        color: #065f46;
    }
    
    .customer-name {
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .customer-email {
        font-size: 0.8rem;
        color: var(--text-secondary);
    }
    
    .timestamp {
        font-size: .8rem;
        color: var(--text-secondary);
    }
    
    .no-tasks-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px 20px;
        color: var(--gray);
    }
    
    .no-tasks-image {
        font-size: 5rem;
        color: var(--gray);
        margin-bottom: 20px;
    }
    
    .no-tasks-text {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--text-primary);
    }
    
    .no-tasks-subtext {
        font-size: 0.9rem;
        color: var(--gray);
    }
    
    /* EXPORT SECTION */
    .export-section {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        background: var(--light);
        padding: 20px;
        border-radius: 12px;
        margin: 20px 0;
        border: 1px solid var(--border-color);
        justify-content: center;
        align-items: end;
    }
    
    /* NOTIFICATION & LOADING */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--card-bg);
        padding: 15px 20px;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0,0,0,.15);
        display: flex;
        align-items: center;
        gap: 10px;
        transform: translateX(150%);
        transition: transform .4s ease;
        z-index: 1000;
        border-left: 4px solid;
        color: var(--text-primary);
    }
    
    .notification.show {
        transform: translateX(0);
    }
    
    .notification.success {
        border-left-color: #10b981;
    }
    
    .success .notification-icon {
        color: #10b981;
    }
    
    .loading-indicator {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,.5);
        z-index: 1003;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        color: white;
    }
    
    .loading-indicator.show {
        display: flex;
    }
    
    .spinner {
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0); }
        100% { transform: rotate(360deg); }
    }
    
    /* MODAL */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,.5);
        z-index: 1001;
        align-items: center;
        justify-content: center;
    }
    
    .modal-content {
        background: var(--card-bg);
        border-radius: 16px;
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,.2);
        transition: all 0.3s ease;
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
    }
    
    .modal-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray);
        min-height: auto;
        padding: 5px;
    }
    
    /* AVATAR MODAL FOOTER */
    .modal-footer {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
        gap: 10px;
    }
    
    .modal-footer .btn {
        min-width: 120px;
    }
    
    .completed-tasks-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .completed-tasks-table th {
        background: var(--table-header-bg);
        padding: 12px 15px;
        text-align: left;
        font-weight: 600;
        color: var(--text-primary);
        border-bottom: 2px solid var(--table-border);
    }
    
    .completed-tasks-table td {
        padding: 12px 15px;
        border-bottom: 1px solid var(--table-border);
        color: var(--text-primary);
    }
    
    .payment-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: .8rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }
    
    .payment-received {
        background: #d1fae5;
        color: #065f46;
    }
    
    .payment-pending {
        background: #fef3c7;
        color: #92400e;
    }
    
    .table-total {
        background: var(--table-header-bg);
        font-weight: 600;
    }
    
    .bulk-actions {
        display: none;
        background: var(--light);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border: 1px solid var(--border-color);
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .bulk-actions.show {
        display: flex;
    }
    
    .bulk-selection-count {
        font-weight: 600;
        color: var(--text-primary);
    }
    
    /* PAYMENT NOTICE */
    .payment-notice {
        background: var(--light);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 25px;
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 15px rgba(0,0,0,.05);
        animation: fadeInUp .6s ease-out;
        display: none;
    }
    
    .payment-notice-content {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .payment-notice-icon {
        background: #d1fae5;
        color: #065f46;
        border-radius: 50%;
        padding: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .payment-notice-text h3 {
        margin-bottom: 5px;
        color: var(--text-primary);
    }
    
    .payment-notice-text p {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    
    .payment-notice-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 15px;
    }
    
    .payment-notice-btn {
        background: #10b981;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: background .3s ease;
    }
    
    /* OTHER SECTIONS (Profile, Settings, Help) */
    .profile-section, .settings-section, .help-section {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 30px;
        box-shadow: var(--shadow);
        margin-bottom: 30px;
        transition: all 0.3s ease;
    }
    
    .profile-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
    }
    
    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2.5rem;
        font-weight: bold;
    }
    
    .profile-info h2 {
        color: var(--text-primary);
        margin-bottom: 5px;
    }
    
    .profile-info p {
        color: var(--text-secondary);
    }
    
    .profile-details {
        display: grid;
        grid-template-columns: repeat(auto-fit,minmax(300px,1fr));
        gap: 20px;
    }
    
    .detail-card {
        background: var(--light);
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid var(--primary);
    }
    
    .detail-card h3 {
        margin-bottom: 15px;
        color: var(--text-primary);
        font-size: 1.1rem;
    }
    
    .detail-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
    }
    
    .detail-label {
        font-weight: 600;
        color: var(--text-primary);
        min-width: 120px;
    }
    
    .detail-value {
        color: var(--text-secondary);
    }
    
    .settings-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--border-color);
    }
    
    .settings-info h4 {
        color: var(--text-primary);
        margin-bottom: 5px;
    }
    
    .settings-info p {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }
    
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
    }
    
    .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    
    input:checked + .slider {
        background-color: var(--primary);
    }
    
    input:checked + .slider:before {
        transform: translateX(26px);
    }
    
    .help-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .help-card {
        background: var(--light);
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        transition: all .3s ease;
        cursor: pointer;
        border: 1px solid var(--border-color);
    }
    
    .help-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,.1);
    }
    
    .help-card i {
        font-size: 2.5rem;
        color: var(--primary);
        margin-bottom: 15px;
    }
    
    .help-card h3 {
        margin-bottom: 10px;
        color: var(--text-primary);
    }
    
    .help-card p {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    
    /* AVATAR SELECTION MODAL - UPDATED */
    .avatar-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin: 20px 0;
        justify-items: center;
    }
    
    .avatar-option {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 3px solid transparent;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }
    
    .avatar-option:hover {
        transform: scale(1.1);
    }
    
    .avatar-option.selected {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.3);
    }
    
    .avatar-option img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    /* SECTION STYLES */
    .section {
        display: none;
    }
    
    .section.active {
        display: block;
    }
    
    /* TOGGLE BUTTONS */
    .toggle-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    /* PROFILE CONTACT BUTTON */
    .profile-contact-btn {
        margin-top: 20px;
        display: flex;
        justify-content: center;
    }
    
    /* MEDIA QUERIES */
    @media (max-width: 1200px) {
        .logout-btn {
            
            margin-bottom: 0;
        }
        
        .dashboard-header {
            
        }
    }
    
    @media (max-width: 768px) {
        .logout-btn {
            
            padding: 8px 16px;
            font-size: .9rem;
        }
        
        .dashboard-header {
            
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .header-left, .header-center, .header-right {
            width: 100%;
            text-align: center;
        }
        
        .header-right {
            justify-content: center;
        }
        
        .date-filters {
            width: 100%;
            justify-content: space-between;
        }
        
        .filter-group {
            flex: 1;
            min-width: 120px;
        }
        
        .stats-grid {
            grid-template-columns: 1fr 1fr;
        }
        
        .charts-grid {
            grid-template-columns: 1fr;
        }
        
        .section-header {
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .dashboard-actions {
            flex-direction: column;
            width: 100%;
        }
        
        .btn {
            width: 100%;
            justify-content: center;
        }
        
        .search-container {
            flex-direction: column;
        }
        
        .export-section {
            flex-direction: column;
        }
        
        .avatar-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .modal-footer {
            flex-direction: column;
            gap: 10px;
        }
        
        .modal-footer .btn {
            width: 100%;
        }
        
        .profile-header {
            flex-direction: column;
            text-align: center;
        }
    }
    
    @media (max-width: 480px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        body {
            padding: 10px;
        }
        
        .dashboard {
            padding: 15px;
        }
        
        .side-drawer {
            width: 280px;
        }
        
        .toggle-buttons {
            flex-direction: column;
        }
        
        .avatar-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .charts-grid {
            gap: 15px;
        }
        
        .chart-container {
            padding: 15px;
        }
    }
</style>
</head>
<body>

<div class="notification success" id="notification">
    <i class="fas fa-check-circle notification-icon"></i>
    <div>
        <div style="font-weight:600" id="notification-title"></div>
        <div style="font-size:.8rem;color:#6c757d" id="notification-message"></div>
    </div>
</div>

<div class="loading-indicator" id="loadingIndicator">
    <i class="fas fa-spinner spinner loading-spinner"></i>
    <div>Loading, please wait...</div>
</div>

<!-- Avatar Selection Modal -->
<div class="modal" id="avatarModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Choose Your Avatar</h2>
            <button class="close-modal" id="closeAvatarModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="avatar-grid" id="avatarGrid">
                <!-- Avatars will be populated by JavaScript -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" id="confirmAvatarSelection">Confirm Selection</button>
        </div>
    </div>
</div>

<div class="side-drawer" id="sideDrawer">
    <div class="drawer-header">
        <button class="drawer-close" id="drawerClose">
            <i class="fas fa-times"></i>
        </button>
        <div class="user-profile">
            <div class="avatar-container">
                <div class="user-avatar" id="currentAvatar">
                    <img src="" alt="User Avatar" id="avatarImage">
                </div>
                <div class="avatar-upload" id="avatarUploadBtn">
                    <i class="fas fa-camera"></i>
                </div>
            </div>
            <div class="user-info">
                <h3>Nithin DL</h3>
                <p>nithinlokhande@gmail.com</p>
                <p>+91 9071880185</p>
            </div>
        </div>
    </div>
    
    <div class="drawer-content">
        <a href="#" class="drawer-item active" data-page="dashboard">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a href="#" class="drawer-item" data-page="tasks">
            <i class="fas fa-tasks"></i>
            <span>My Tasks</span>
        </a>
        <a href="#" class="drawer-item" data-page="help">
            <i class="fas fa-question-circle"></i>
            <span>Help & Support</span>
        </a>
        <a href="#" class="drawer-item" data-page="settings">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </a>
        <a href="#" class="drawer-item" data-page="profile">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </div>
    
    <div class="drawer-footer">
        <button class="whatsapp-btn" id="whatsappBtn">
            <i class="fab fa-whatsapp"></i>
            Contact Support
        </button>
        <div class="contact-info">
            Need help? Contact us at <strong>9071880185</strong>
        </div>
    </div>
</div>

<div class="drawer-overlay" id="drawerOverlay"></div>

<!-- Completed Tasks Modal -->
<div class="modal" id="completedTasksModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Completed Tasks & Earnings</h2>
            <button class="close-modal" id="closeCompletedModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="toggle-buttons">
                <button class="toggle-btn active" id="toggleReceived">Payment Received</button>
                <button class="toggle-btn" id="togglePending">Payment Pending</button>
            </div>
            <div class="payment-notice" id="modalPaymentNotice">
                <div class="payment-notice-content">
                    <div class="payment-notice-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="payment-notice-text">
                        <h3>Payment Processing</h3>
                        <p>The project has been forwarded to the Finance Department.<br>Your payment will be processed soon.</p>
                    </div>
                </div>
                <div class="payment-notice-actions">
                    <button class="payment-notice-btn" id="dismissModalNotice">OK, Got it</button>
                </div>
            </div>
            <table class="completed-tasks-table">
                <thead>
                    <tr>
                        <th>Task Name</th>
                        <th>Customer</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Earnings</th>
                        <th>Payment Status</th>
                    </tr>
                </thead>
                <tbody id="completedTasksList"></tbody>
            </table>
            <div id="noCompletedTasksMessage" class="no-tasks-container" style="display:none">
                <div class="no-tasks-image">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="no-tasks-text">No completed tasks available</div>
                <div class="no-tasks-subtext">There are no completed tasks for the selected period</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="closeCompletedModalBtn">Close</button>
        </div>
    </div>
</div>

<!-- Pending Tasks Modal -->
<div class="modal" id="pendingTasksModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Pending Tasks</h2>
            <button class="close-modal" id="closePendingModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="bulk-actions" id="pendingBulkActions">
                <div class="bulk-selection-count" id="pendingSelectionCount">0 tasks selected</div>
                <button class="btn btn-primary" id="markPendingAsComplete">
                    <i class="fas fa-check-circle"></i> Mark as Complete
                </button>
                <button class="btn btn-secondary" id="clearPendingSelection">
                    <i class="fas fa-times"></i> Clear Selection
                </button>
            </div>
            <table class="completed-tasks-table">
                <thead>
                    <tr>
                        <th style="width:40px">
                            <input type="checkbox" id="selectAllPending">
                        </th>
                        <th>Task Name</th>
                        <th>Customer</th>
                        <th>Start Date</th>
                        <th>Last Update</th>
                        <th>Earnings</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="pendingTasksList"></tbody>
                <tfoot>
                    <tr class="table-total">
                        <td colspan="6" style="text-align:right">Total Value:</td>
                        <td id="pendingTotalValue">₹0</td>
                    </tr>
                </tfoot>
            </table>
            <div id="noPendingTasksMessage" class="no-tasks-container" style="display:none">
                <div class="no-tasks-image">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="no-tasks-text">No pending tasks available</div>
                <div class="no-tasks-subtext">All tasks are either in review or completed</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="closePendingModalBtn">Close</button>
        </div>
    </div>
</div>

<!-- Review Tasks Modal -->
<div class="modal" id="reviewTasksModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Tasks In Review</h2>
            <button class="close-modal" id="closeReviewModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="bulk-actions" id="reviewBulkActions">
                <div class="bulk-selection-count" id="reviewSelectionCount">0 tasks selected</div>
                <button class="btn btn-primary" id="markReviewAsComplete">
                    <i class="fas fa-check-circle"></i> Mark as Complete
                </button>
                <button class="btn btn-secondary" id="clearReviewSelection">
                    <i class="fas fa-times"></i> Clear Selection
                </button>
            </div>
            <table class="completed-tasks-table">
                <thead>
                    <tr>
                        <th style="width:40px">
                            <input type="checkbox" id="selectAllReview">
                        </th>
                        <th>Task Name</th>
                        <th>Customer</th>
                        <th>Start Date</th>
                        <th>Last Update</th>
                        <th>Earnings</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="reviewTasksList"></tbody>
                <tfoot>
                    <tr class="table-total">
                        <td colspan="6" style="text-align:right">Total Value:</td>
                        <td id="reviewTotalValue">₹0</td>
                    </tr>
                </tfoot>
            </table>
            <div id="noReviewTasksMessage" class="no-tasks-container" style="display:none">
                <div class="no-tasks-image">
                    <i class="fas fa-search"></i>
                </div>
                <div class="no-tasks-text">No tasks in review</div>
                <div class="no-tasks-subtext">All tasks are either pending or completed</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="closeReviewModalBtn">Close</button>
        </div>
    </div>
</div>

<div class="dashboard">
    <!-- Improved Hamburger Menu -->
    <!-- ADD THIS AT THE TOP OF YOUR DASHBOARD -->
<div class="top-bar">
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>
    <button class="logout-btn" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i> Logout
    </button>
</div>

    <!-- Dashboard Section -->
    <div class="section active" id="dashboardSection">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="current-time" id="currentTime">Loading...</div>
                <div class="current-date" id="currentDate">Loading...</div>
            </div>
            <div class="header-center">
                <div class="header-title">
                    <h1>Task Management Dashboard</h1>
                    <p>Track your tasks and earnings in real-time</p>
                </div>
                <div class="search-container">
                    <input type="text" class="search-input" id="taskSearch" placeholder="Search tasks or customers...">
                    <button class="search-button-inside" id="searchButtonInside" title="Search">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-outline" id="toggleFilter">
                    <i class="fas fa-filter"></i> Show Filters
                </button>
                <button class="btn btn-secondary" id="refreshData">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
            </div>
        </div>

        <div class="date-filters" id="dateFilters">
            <div class="filter-group">
                <div class="filter-label">Time Period</div>
                <select id="timePeriod">
                    <option value="all">All Tasks</option>
                    <option value="lastWeek">Last Week</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="quarter">This Quarter</option>
                    <option value="year">This Year</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">From Date</div>
                <input type="date" id="fromDate">
            </div>
            <div class="filter-group">
                <div class="filter-label">To Date</div>
                <input type="date" id="toDate">
            </div>
            <div class="filter-group">
                <div class="filter-label">&nbsp;</div>
                <button class="btn btn-primary" id="applyFilter">
                    <i class="fas fa-filter"></i> Apply Filter
                </button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card pending" id="pendingTasksCard">
                <i class="fas fa-clock stat-icon"></i>
                <div class="stat-value"><span id="pending-tasks">3</span></div>
                <div class="stat-label">Pending Tasks</div>
                <div class="stat-total">Total: ₹29,700</div>
            </div>
            <div class="stat-card in-review" id="reviewTasksCard">
                <i class="fas fa-search stat-icon"></i>
                <div class="stat-value"><span id="review-tasks">3</span></div>
                <div class="stat-label">In Review</div>
                <div class="stat-total">Total: ₹31,500</div>
            </div>
            <div class="stat-card completed" id="completedTasksCard">
                <i class="fas fa-check-circle stat-icon"></i>
                <div class="stat-value"><span id="completed-tasks">4</span></div>
                <div class="stat-label">Completed</div>
                <div class="stat-total">Received: ₹20,500</div>
            </div>
            <div class="stat-card earnings" id="totalEarningsCard">
                <i class="fas fa-rupee-sign stat-icon"></i>
                <div class="stat-value">₹<span id="total-earnings">20,500</span></div>
                <div class="stat-label">Total Earnings (Received)</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title" id="tasksChartTitle">Task Completion Progress</div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="tasksChart"></canvas>
                    <div id="noTasksChartMessage" class="no-data-message" style="display:none">
                        <i class="fas fa-chart-bar no-data-icon"></i>
                        <div class="no-data-text">No Data Available</div>
                        <div class="no-data-subtext">There is no task data for the selected period</div>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Task Status Distribution</div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="distributionChart"></canvas>
                    <div id="noDistributionChartMessage" class="no-data-message" style="display:none">
                        <i class="fas fa-chart-pie no-data-icon"></i>
                        <div class="no-data-text">No Data Available</div>
                        <div class="no-data-subtext">There is no task data for the selected period</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tasks-section">
            <div class="section-header">
                <div class="chart-title">Recent Tasks</div>
                <div class="dashboard-actions">
                    <button class="btn btn-secondary" id="exportTasks">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
            <div class="table-container">
                <table class="tasks-table">
                    <thead>
                        <tr>
                            <th>Task Name</th>
                            <th>Customer</th>
                            <th>Status</th>
                            <th>Start Date</th>
                            <th>Last Update</th>
                            <th>Earnings</th>
                            <th>Payment Status</th>
                        </tr>
                    </thead>
                    <tbody id="tasksTableBody"></tbody>
                </table>
                <div id="noTasksMessage" class="no-tasks-container" style="display:none">
                    <div class="no-tasks-image">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="no-tasks-text">No tasks available</div>
                    <div class="no-tasks-subtext">There are no tasks for the selected date range</div>
                </div>
            </div>
        </div>
    </div>

    <!-- My Tasks Section -->
    <div class="section" id="tasksSection">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="current-date" id="tasksCurrentDate">Loading...</div>
            </div>
            <div class="header-center">
                <div class="header-title">
                    <h1>My Tasks</h1>
                </div>
                <div class="search-container">
                    <input type="text" class="search-input" id="myTasksSearch" placeholder="Search my tasks...">
                    <button class="search-button-inside" id="myTasksSearchButtonInside" title="Search">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-outline" id="toggleMyTasksFilter">
                    <i class="fas fa-filter"></i> Show Filters
                </button>
            </div>
        </div>

        <div class="date-filters" id="myTasksDateFilters">
            <div class="filter-group">
                <div class="filter-label">Time Period</div>
                <select id="myTasksTimePeriod">
                    <option value="all">All Tasks</option>
                    <option value="lastWeek">Last Week</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="quarter">This Quarter</option>
                    <option value="year">This Year</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">From Date</div>
                <input type="date" id="myTasksFromDate">
            </div>
            <div class="filter-group">
                <div class="filter-label">To Date</div>
                <input type="date" id="myTasksToDate">
            </div>
            <div class="filter-group">
                <div class="filter-label">&nbsp;</div>
                <button class="btn btn-primary" id="applyMyTasksFilter">
                    <i class="fas fa-filter"></i> Apply Filter
                </button>
            </div>
        </div>

        <div class="tasks-section">
            <div class="section-header">
                <div class="chart-title">All My Tasks</div>
                <div class="dashboard-actions">
                    <button class="btn btn-secondary" id="exportMyTasks">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
            <div class="table-container">
                <table class="tasks-table">
                    <thead>
                        <tr>
                            <th>Task Name</th>
                            <th>Customer</th>
                            <th>Status</th>
                            <th>Start Date</th>
                            <th>Last Update</th>
                            <th>Earnings</th>
                            <th>Payment Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="myTasksTableBody"></tbody>
                </table>
                <div id="noMyTasksMessage" class="no-tasks-container" style="display:none">
                    <div class="no-tasks-image">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="no-tasks-text">No tasks available</div>
                    <div class="no-tasks-subtext">There are no tasks for the selected date range</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help & Support Section -->
    <div class="section" id="helpSection">
        <div class="dashboard-header">
            <div class="header-center">
                <div class="header-title">
                    <h1>Help & Support</h1>
                    <p>Get assistance and resources for using the dashboard</p>
                </div>
            </div>
        </div>

        <div class="help-section">
            <p style="margin-bottom:20px;color:var(--text-secondary);">Get help and support for using the Task Management Dashboard</p>
            <div class="help-cards">
                <div class="help-card">
                    <i class="fas fa-book"></i>
                    <h3>Documentation</h3>
                    <p>Complete user guide and documentation</p>
                </div>
                <div class="help-card">
                    <i class="fas fa-video"></i>
                    <h3>Video Tutorials</h3>
                    <p>Step-by-step video guides</p>
                </div>
                <div class="help-card">
                    <i class="fas fa-question-circle"></i>
                    <h3>FAQ</h3>
                    <p>Frequently asked questions</p>
                </div>
                <div class="help-card">
                    <i class="fas fa-headset"></i>
                    <h3>Contact Support</h3>
                    <p>24/7 customer support</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Section -->
    <div class="section" id="settingsSection">
        <div class="dashboard-header">
            <div class="header-center">
                <div class="header-title">
                    <h1>Settings</h1>
                    <p>Configure your dashboard preferences</p>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-option">
                <div class="settings-info">
                    <h4>Email Notifications</h4>
                    <p>Receive email notifications for task updates</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <div class="settings-info">
                    <h4>Desktop Notifications</h4>
                    <p>Show desktop notifications for new tasks</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <div class="settings-info">
                    <h4>Auto Refresh</h4>
                    <p>Automatically refresh data every 5 minutes</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <div class="settings-info">
                    <h4>Dark Mode</h4>
                    <p>Switch to dark mode theme</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>

    <!-- Profile Section -->
    <div class="section" id="profileSection">
        <div class="dashboard-header">
            <div class="header-center">
                <div class="header-title">
                    <h1>Profile</h1>
                    <p>Manage your personal information and account settings</p>
                </div>
            </div>
        </div>

        <div class="profile-section">
            <div class="profile-header">
                <div class="profile-avatar">ND</div>
                <div class="profile-info">
                    <h2>Nithin DL</h2>
                    <p>Senior Task Manager</p>
                </div>
            </div>
            
            <!-- Contact Support Button Below Profile -->
            <div class="profile-contact-btn">
                <button class="whatsapp-btn" id="profileWhatsappBtn">
                    <i class="fab fa-whatsapp"></i>
                    Contact Support
                </button>
            </div>
            
            <div class="profile-details">
                <div class="detail-card">
                    <h3>Personal Information</h3>
                    <div class="detail-item">
                        <span class="detail-label">Full Name:</span>
                        <span class="detail-value">Nithin DL</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value">nithinlokhande@gmail.com</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Phone:</span>
                        <span class="detail-value">+91 9071880185</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Department:</span>
                        <span class="detail-value">Task Management</span>
                    </div>
                </div>
                <div class="detail-card">
                    <h3>Account Information</h3>
                    <div class="detail-item">
                        <span class="detail-label">Member Since:</span>
                        <span class="detail-value">January 2023</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Last Login:</span>
                        <span class="detail-value" id="lastLoginTime">Today, 09:30 AM</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Tasks Completed:</span>
                        <span class="detail-value">47</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Total Earnings:</span>
                        <span class="detail-value">₹2,45,600</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Theme Management
    const ThemeManager = {
        currentTheme: 'light',
        
        initialize() {
            // Load saved theme from localStorage
            const savedTheme = localStorage.getItem('dashboardTheme');
            if (savedTheme) {
                this.currentTheme = savedTheme;
                this.applyTheme(savedTheme);
                document.getElementById('darkModeToggle').checked = savedTheme === 'dark';
            }
        },
        
        applyTheme(theme) {
            this.currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('dashboardTheme', theme);
        },
        
        toggleTheme() {
            const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
            this.applyTheme(newTheme);
            return newTheme;
        }
    };

    // Avatar Management
    const AvatarManager = {
        avatars: [
            'https://api.dicebear.com/7.x/avataaars/svg?seed=1',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=2',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=3',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=4',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=5',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=6',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=7',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=8'
        ],
        
        currentAvatar: 0,
        
        initialize() {
            // Load saved avatar from localStorage
            const savedAvatar = localStorage.getItem('userAvatar');
            if (savedAvatar) {
                this.currentAvatar = parseInt(savedAvatar);
            }
            
            this.updateAvatarDisplay();
            this.populateAvatarGrid();
        },
        
        populateAvatarGrid() {
            const avatarGrid = document.getElementById('avatarGrid');
            avatarGrid.innerHTML = '';
            
            this.avatars.forEach((avatar, index) => {
                const avatarOption = document.createElement('div');
                avatarOption.className = `avatar-option ${index === this.currentAvatar ? 'selected' : ''}`;
                avatarOption.innerHTML = `<img src="${avatar}" alt="Avatar ${index + 1}" style="width: 100%; height: 100%; border-radius: 50%;">`;
                avatarOption.addEventListener('click', () => this.selectAvatar(index));
                avatarGrid.appendChild(avatarOption);
            });
        },
        
        selectAvatar(index) {
            // Remove selected class from all avatars
            document.querySelectorAll('.avatar-option').forEach(avatar => {
                avatar.classList.remove('selected');
            });
            
            // Add selected class to clicked avatar
            document.querySelectorAll('.avatar-option')[index].classList.add('selected');
            this.currentAvatar = index;
        },
        
        updateAvatarDisplay() {
            const avatarImage = document.getElementById('avatarImage');
            avatarImage.src = this.avatars[this.currentAvatar];
        },
        
        saveAvatar() {
            localStorage.setItem('userAvatar', this.currentAvatar.toString());
            this.updateAvatarDisplay();
            UIManager.showNotification('Avatar Updated', 'Your profile picture has been updated successfully!');
        }
    };

    // Data Management Module
    const UserData = {
        currentUser: {
            name: "Nithin DL",
            email: "nithinlokhande@gmail.com",
            phone: "+91 9071880185",
            department: "Task Management",
            memberSince: "January 2023",
            lastLogin: "Today, 09:30 AM",
            tasksCompleted: 47,
            totalEarnings: "₹2,45,600"
        }
    };
    
    const TaskManager = {
        tasks: [
            {id:1,name:"Website Redesign Project",customer:{name:"Rajesh Kumar",email:"rajesh@abc.com"},status:"pending",startDate:"2024-03-20",lastUpdate:"2024-03-20 09:30",earnings:"₹8,000",paymentStatus:"pending"},
            {id:2,name:"Mobile App Development",customer:{name:"Priya Sharma",email:"priya@xyz.com"},status:"in-review",startDate:"2024-03-18",lastUpdate:"2024-03-22 14:15",earnings:"₹12,000",paymentStatus:"pending"},
            {id:3,name:"E-commerce Dashboard",customer:{name:"Amit Patel",email:"amit@company.com"},status:"in-review",startDate:"2024-03-15",lastUpdate:"2024-03-21 11:45",earnings:"₹15,000",paymentStatus:"pending"},
            {id:4,name:"SEO Optimization",customer:{name:"Neha Gupta",email:"neha@business.com"},status:"completed",startDate:"2024-03-10",lastUpdate:"2024-03-18 16:20",earnings:"₹6,000",paymentStatus:"received",paymentDate:"2024-03-20"},
            {id:5,name:"Content Writing Project",customer:{name:"Sanjay Mehta",email:"sanjay@enterprise.com"},status:"in-review",startDate:"2024-03-22",lastUpdate:"2024-03-22 10:00",earnings:"₹4,500",paymentStatus:"pending"},
            {id:6,name:"Social Media Marketing",customer:{name:"Anita Desai",email:"anita@startup.com"},status:"pending",startDate:"2024-03-25",lastUpdate:"2024-03-25 09:00",earnings:"₹7,200",paymentStatus:"pending"},
            {id:7,name:"Logo Design",customer:{name:"Rahul Verma",email:"rahul@design.com"},status:"completed",startDate:"2024-03-12",lastUpdate:"2024-03-15 14:30",earnings:"₹3,500",paymentStatus:"received",paymentDate:"2024-03-18"},
            {id:8,name:"Brand Identity",customer:{name:"Sneha Joshi",email:"sneha@brand.com"},status:"completed",startDate:"2024-03-08",lastUpdate:"2024-03-14 12:15",earnings:"₹9,000",paymentStatus:"pending"},
            {id:9,name:"UI/UX Design",customer:{name:"Vikram Singh",email:"vikram@tech.com"},status:"completed",startDate:"2024-03-05",lastUpdate:"2024-03-12 16:45",earnings:"₹11,000",paymentStatus:"received",paymentDate:"2024-03-15"},
            {id:10,name:"Backend Development",customer:{name:"Arun Kumar",email:"arun@dev.com"},status:"pending",startDate:"2024-03-03",lastUpdate:"2024-03-10 11:20",earnings:"₹14,500",paymentStatus:"pending"}
        ],
        
        searchTasks(query) {
            if(!query) return this.tasks;
            const q = query.toLowerCase();
            return this.tasks.filter(t => 
                t.name.toLowerCase().includes(q) || 
                t.customer.name.toLowerCase().includes(q) || 
                t.customer.email.toLowerCase().includes(q)
            );
        },
        
        filterTasksByDate(f, t) {
            if(!f || !t) return this.tasks;
            const fromDate = new Date(f), toDate = new Date(t);
            return this.tasks.filter(task => {
                const taskDate = new Date(task.startDate);
                return taskDate >= fromDate && taskDate <= toDate;
            });
        },
        
        getTasksByStatus(s) {
            return s === 'all' ? this.tasks : this.tasks.filter(t => t.status === s);
        },
        
        updateTaskStatus(id, s) {
            const t = this.tasks.find(t => t.id === id);
            if(t) {
                t.status = s;
                t.lastUpdate = new Date().toLocaleString('en-IN');
                return true;
            }
            return false;
        },
        
        markTasksAsComplete(ids) {
            let count = 0;
            ids.forEach(id => {
                if(this.updateTaskStatus(id, 'completed')) count++;
            });
            return count;
        }
    };

    // Chart Management Module
    const ChartManager = {
        tasksChart: null,
        distributionChart: null,
        
        initializeCharts(tasks, period) {
            if(this.tasksChart) this.tasksChart.destroy();
            if(this.distributionChart) this.distributionChart.destroy();
            
            const taskCanvas = document.getElementById('tasksChart');
            const distCanvas = document.getElementById('distributionChart');
            const noTaskMsg = document.getElementById('noTasksChartMessage');
            const noDistMsg = document.getElementById('noDistributionChartMessage');
            
            if(tasks.length === 0) {
                taskCanvas.style.display = 'none';
                distCanvas.style.display = 'none';
                noTaskMsg.style.display = 'flex';
                noDistMsg.style.display = 'flex';
                return;
            } else {
                taskCanvas.style.display = 'block';
                distCanvas.style.display = 'block';
                noTaskMsg.style.display = 'none';
                noDistMsg.style.display = 'none';
            }
            
            let chartLabels = [], chartData = [], chartTitle = "Task Completion Progress";
            const completedTasks = tasks.filter(t => t.status === 'completed');
            
            if(['lastWeek','week'].includes(period)) {
                const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
                chartLabels = days;
                chartTitle = "Weekly Task Completion";
                const dayData = Array(7).fill(0);
                completedTasks.forEach(t => {
                    dayData[new Date(t.startDate).getDay()]++;
                });
                chartData = dayData;
            } else if(period === 'month') {
                chartLabels = ['Week 1','Week 2','Week 3','Week 4'];
                chartTitle = "Monthly Task Completion";
                const weekData = Array(4).fill(0);
                completedTasks.forEach(t => {
                    const day = new Date(t.startDate).getDate();
                    const week = Math.floor((day - 1) / 7);
                    if(week < 4) weekData[week]++;
                });
                chartData = weekData;
            } else if(period === 'year') {
                const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
                chartLabels = months;
                chartTitle = "Yearly Task Completion";
                const monthData = Array(12).fill(0);
                completedTasks.forEach(t => {
                    monthData[new Date(t.startDate).getMonth()]++;
                });
                chartData = monthData;
            } else {
                const uniqueDates = [...new Set(completedTasks.map(t => t.startDate))].sort();
                chartLabels = uniqueDates.map(this.formatDate);
                chartTitle = "Task Completion by Date";
                const dateData = {};
                completedTasks.forEach(t => {
                    dateData[t.startDate] = (dateData[t.startDate] || 0) + 1;
                });
                chartData = uniqueDates.map(date => dateData[date] || 0);
            }
            
            document.getElementById('tasksChartTitle').textContent = chartTitle;

            const tasksCtx = taskCanvas.getContext('2d');
            this.tasksChart = new Chart(tasksCtx, {
                type: 'bar',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Tasks Completed',
                        data: chartData,
                        backgroundColor: '#4ade80',
                        borderRadius: 8,
                        borderColor: '#22c55e',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {display: true, text: 'Number of Tasks'},
                            grid: {color: 'rgba(0,0,0,0.1)'},
                            ticks: {stepSize: 1, precision: 0}
                        },
                        x: {grid: {display: false}}
                    }
                }
            });

            const distCtx = distCanvas.getContext('2d');
            const pending = tasks.filter(t => t.status === 'pending').length;
            const inReview = tasks.filter(t => t.status === 'in-review').length;
            const completed = tasks.filter(t => t.status === 'completed').length;
            
            // Updated pie chart colors
            this.distributionChart = new Chart(distCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Pending','In Review','Completed'],
                    datasets: [{
                        data: [pending, inReview, completed],
                        backgroundColor: ['#FF6384', '#36A2EB', '#4BC0C0'], // New colors
                        borderColor: ['#FF6384', '#36A2EB', '#4BC0C0'],
                        borderWidth: 3,
                        borderAlign: 'inner'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {usePointStyle: true, padding: 20}
                        },
                        tooltip: {
                            callbacks: {
                                label: c => {
                                    const t = c.dataset.data.reduce((a,b) => a + b, 0);
                                    const p = t > 0 ? Math.round(c.parsed / t * 100) : 0;
                                    return `${c.label}: ${c.parsed} tasks (${p}%)`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        },
        
        formatDate(d) {
            const options = {year: 'numeric', month: 'short', day: 'numeric'};
            return new Date(d).toLocaleDateString('en-IN', options);
        }
    };

    // UI Management Module
    const UIManager = {
        _formatDate: (d) => {
            const o = {year: 'numeric', month: 'short', day: 'numeric'};
            return new Date(d).toLocaleDateString('en-IN', o);
        },
        
        _formatTime: (d) => {
            const o = {hour: '2-digit', minute: '2-digit'};
            return new Date(d).toLocaleTimeString('en-IN', o);
        },
        
        populateTasksTable(tasks) {
            const tBody = document.getElementById('tasksTableBody');
            const noMsg = document.getElementById('noTasksMessage');
            tBody.innerHTML = '';
            
            if(tasks.length === 0) {
                noMsg.style.display = 'flex';
                return;
            } else {
                noMsg.style.display = 'none';
            }
            
            tasks.forEach(t => {
                let c = '', txt = '';
                switch(t.status) {
                    case 'pending': c = 'status-pending'; txt = 'Pending'; break;
                    case 'in-review': c = 'status-review'; txt = 'In Review'; break;
                    case 'completed': c = 'status-completed'; txt = 'Completed'; break;
                }
                
                // Payment status with icons
                let paymentStatus = '';
                if(t.status === 'completed') {
                    if(t.paymentStatus === 'received') {
                        paymentStatus = `<span class="payment-status payment-received"><i class="fas fa-check-circle"></i> Paid</span>`;
                    } else {
                        paymentStatus = `<span class="payment-status payment-pending"><i class="fas fa-clock"></i> Payment Pending</span>`;
                    }
                } else {
                    paymentStatus = `<span class="payment-status payment-pending"><i class="fas fa-clock"></i> Payment Pending</span>`;
                }
                
                tBody.innerHTML += `
                    <tr>
                        <td>
                            <div style="font-weight:600">${t.name}</div>
                            <div class="timestamp">Task ID: ${t.id}</div>
                        </td>
                        <td>
                            <div class="customer-info">
                                <div class="customer-name">${t.customer.name}</div>
                                <div class="customer-email">${t.customer.email}</div>
                            </div>
                        </td>
                        <td>
                            <span class="task-status ${c}">${txt}</span>
                        </td>
                        <td>
                            <div class="timestamp">${this._formatDate(t.startDate)}</div>
                        </td>
                        <td>
                            <div class="timestamp">${t.lastUpdate}</div>
                        </td>
                        <td>
                            <div style="font-weight:600;color:var(--secondary)">${t.earnings}</div>
                        </td>
                        <td>
                            ${paymentStatus}
                        </td>
                    </tr>
                `;
            });
        },
        
        populateMyTasksTable() {
            const tBody = document.getElementById('myTasksTableBody');
            const noMsg = document.getElementById('noMyTasksMessage');
            tBody.innerHTML = '';
            
            if(TaskManager.tasks.length === 0) {
                noMsg.style.display = 'flex';
                return;
            } else {
                noMsg.style.display = 'none';
            }
            
            TaskManager.tasks.forEach(t => {
                let c = '', txt = '';
                switch(t.status) {
                    case 'pending': c = 'status-pending'; txt = 'Pending'; break;
                    case 'in-review': c = 'status-review'; txt = 'In Review'; break;
                    case 'completed': c = 'status-completed'; txt = 'Completed'; break;
                }
                
                // Payment status with icons
                let paymentStatus = '';
                if(t.status === 'completed') {
                    if(t.paymentStatus === 'received') {
                        paymentStatus = `<span class="payment-status payment-received"><i class="fas fa-check-circle"></i> Paid</span>`;
                    } else {
                        paymentStatus = `<span class="payment-status payment-pending"><i class="fas fa-clock"></i> Payment Pending</span>`;
                    }
                } else {
                    paymentStatus = `<span class="payment-status payment-pending"><i class="fas fa-clock"></i> Payment Pending</span>`;
                }
                
                tBody.innerHTML += `
                    <tr>
                        <td>
                            <div style="font-weight:600">${t.name}</div>
                            <div class="timestamp">Task ID: ${t.id}</div>
                        </td>
                        <td>
                            <div class="customer-info">
                                <div class="customer-name">${t.customer.name}</div>
                                <div class="customer-email">${t.customer.email}</div>
                            </div>
                        </td>
                        <td>
                            <span class="task-status ${c}">${txt}</span>
                        </td>
                        <td>
                            <div class="timestamp">${this._formatDate(t.startDate)}</div>
                        </td>
                        <td>
                            <div class="timestamp">${t.lastUpdate}</div>
                        </td>
                        <td>
                            <div style="font-weight:600;color:var(--secondary)">${t.earnings}</div>
                        </td>
                        <td>
                            ${paymentStatus}
                        </td>
                        <td>
                            <button class="btn btn-primary" style="padding:5px 10px;font-size:.8rem;">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </td>
                    </tr>
                `;
            });
        },
        
        updateStats(tasks) {
            const filter = (s, p = false) => tasks.filter(t => t.status === s && (p ? !t.paymentStatus || t.paymentStatus === 'pending' : true));
            const totalValue = (s, p = false) => {
                return filter(s, p).reduce((sum, t) => sum + parseInt(t.earnings.replace(/[₹,]/g, '')), 0);
            };
            
            const pending = filter('pending').length;
            const review = filter('in-review').length;
            const completed = filter('completed').length;
            const received = totalValue('completed').toLocaleString('en-IN');
            
            document.getElementById('pending-tasks').textContent = pending;
            document.getElementById('review-tasks').textContent = review;
            document.getElementById('completed-tasks').textContent = completed;
            document.getElementById('total-earnings').textContent = received;
            
            document.querySelector('#pendingTasksCard .stat-total').textContent = `Total: ₹${totalValue('pending').toLocaleString('en-IN')}`;
            document.querySelector('#reviewTasksCard .stat-total').textContent = `Total: ₹${totalValue('in-review').toLocaleString('en-IN')}`;
            document.querySelector('#completedTasksCard .stat-total').textContent = `Received: ₹${received}`;
        },
        
        showNotification(title, msg, type = 'success') {
            const n = document.getElementById('notification');
            n.querySelector('#notification-title').textContent = title;
            n.querySelector('#notification-message').textContent = msg;
            n.className = 'notification';
            n.classList.add(type);
            n.classList.add('show');
            setTimeout(() => n.classList.remove('show'), 3000);
        },
        
        showLoading(show = true) {
            const l = document.getElementById('loadingIndicator');
            l.classList.toggle('show', show);
            document.body.classList.toggle('lock-scroll', show);
        },
        
        showSection(page) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show the selected section
            document.getElementById(page + 'Section').classList.add('active');
            
            // Update active state in sidebar
            document.querySelectorAll('.drawer-item').forEach(i => {
                i.classList.remove('active');
            });
            document.querySelector(`.drawer-item[data-page="${page}"]`).classList.add('active');
            
            // Update clock for all sections
            this.updateClock();
        },
        
        updateClock() {
            const now = new Date();
            const timeOptions = {hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true};
            const dateOptions = {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'};
            
            // Update all clock elements
            document.querySelectorAll('.current-time').forEach(el => {
                el.textContent = now.toLocaleTimeString('en-IN', timeOptions);
            });
            
            document.querySelectorAll('.current-date').forEach(el => {
                el.textContent = now.toLocaleDateString('en-IN', dateOptions);
            });
            
            document.getElementById('lastLoginTime').textContent = `Today, ${now.toLocaleTimeString('en-IN', {hour: '2-digit', minute: '2-digit', hour12: true})}`;
        }
    };

    // Bulk Actions Module
    const BulkActions = {
        selectedTasks: {pending: [], review: []},
        
        toggleTaskSelection(id, s, sel) {
            this.selectedTasks[s] = sel ?
                (this.selectedTasks[s].includes(id) ? this.selectedTasks[s] : [...this.selectedTasks[s], id]) :
                this.selectedTasks[s].filter(i => i !== id);
            this.updateSelectionCount(s);
        },
        
        selectAllTasks(s, tasks, sel) {
            this.selectedTasks[s] = sel ? tasks.map(t => t.id) : [];
            this.updateSelectionCount(s);
            this.updateCheckboxes(s, tasks, sel);
        },
        
        updateSelectionCount(s) {
            const count = this.selectedTasks[s].length;
            const countEl = document.getElementById(`${s}SelectionCount`);
            const bulkEl = document.getElementById(`${s}BulkActions`);
            
            if(countEl) countEl.textContent = `${count} task${count !== 1 ? 's' : ''} selected`;
            if(bulkEl) bulkEl.classList.toggle('show', count > 0);
        },
        
        updateCheckboxes(s, tasks, sel) {
            tasks.forEach(t => {
                const cb = document.getElementById(`task-${s}-${t.id}`);
                if(cb) cb.checked = sel;
            });
            
            const allCb = document.getElementById(`selectAll${s.charAt(0).toUpperCase() + s.slice(1)}`);
            if(allCb) allCb.checked = sel;
        },
        
        clearSelection(s) {
            this.selectAllTasks(s, TaskManager.getTasksByStatus(s), false);
        },
        
        markSelectedAsComplete(s) {
            if(this.selectedTasks[s].length === 0) return 0;
            
            const count = TaskManager.markTasksAsComplete(this.selectedTasks[s]);
            if(count > 0) {
                this.clearSelection(s);
                Dashboard.refreshData();
                UIManager.showNotification('Tasks Updated', `${count} task${count !== 1 ? 's' : ''} marked as complete.`, 'success');
            }
            return count;
        }
    };

    // Dashboard Controller
    const Dashboard = {
        currentPage: 'dashboard',
        
        initialize() {
            document.getElementById('timePeriod').value = 'all';
            document.getElementById('myTasksTimePeriod').value = 'all';
            this._loadUserPreferences();
            this.refreshData();
            this._initializeDrawer();
            this._setupEventListeners();
            UIManager.populateMyTasksTable();
            UIManager.updateClock();
            AvatarManager.initialize();
            ThemeManager.initialize();
            
            setInterval(() => UIManager.updateClock(), 1000);
        },
        
        _loadUserPreferences() {
            try {
                const p = JSON.parse(localStorage.getItem('dashboardPrefs')) || {};
                if(p.defaultView) {
                    document.getElementById('timePeriod').value = p.defaultView;
                    this._setDateRange(p.defaultView);
                }
            } catch(e) {
                console.error('Error loading preferences:', e);
            }
        },
        
        _saveUserPreferences() {
            localStorage.setItem('dashboardPrefs', JSON.stringify({
                defaultView: document.getElementById('timePeriod').value
            }));
        },
        
        refreshData() {
            const f = document.getElementById('fromDate').value;
            const t = document.getElementById('toDate').value;
            const p = document.getElementById('timePeriod').value;
            const s = document.getElementById('taskSearch').value;
            
            let tasks = s ? TaskManager.searchTasks(s) : TaskManager.filterTasksByDate(f, t);
            
            UIManager.populateTasksTable(tasks);
            UIManager.updateStats(tasks);
            ChartManager.initializeCharts(tasks, p);
        },
        
        refreshMyTasksData() {
            const f = document.getElementById('myTasksFromDate').value;
            const t = document.getElementById('myTasksToDate').value;
            const p = document.getElementById('myTasksTimePeriod').value;
            const s = document.getElementById('myTasksSearch').value;
            
            let tasks = s ? TaskManager.searchTasks(s) : TaskManager.filterTasksByDate(f, t);
            
            UIManager.populateMyTasksTable(tasks);
        },
        
        _setDateRange(p, isMyTasks = false) {
            const now = new Date();
            let fromDate, toDate;
            const prefix = isMyTasks ? 'myTasks' : '';
            
            switch(p) {
                case 'lastWeek':
                    fromDate = new Date(now);
                    fromDate.setDate(now.getDate() - 7);
                    toDate = new Date(now);
                    toDate.setDate(now.getDate() - 1);
                    break;
                case 'week':
                    fromDate = new Date(now);
                    fromDate.setDate(now.getDate() - now.getDay());
                    toDate = new Date(fromDate);
                    toDate.setDate(fromDate.getDate() + 6);
                    break;
                case 'month':
                    fromDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    toDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    break;
                case 'quarter':
                    const q = Math.floor(now.getMonth() / 3);
                    fromDate = new Date(now.getFullYear(), q * 3, 1);
                    toDate = new Date(now.getFullYear(), q * 3 + 3, 0);
                    break;
                case 'year':
                    fromDate = new Date(now.getFullYear(), 0, 1);
                    toDate = new Date(now.getFullYear(), 11, 31);
                    break;
                case 'all':
                    document.getElementById(prefix + 'FromDate').value = '';
                    document.getElementById(prefix + 'ToDate').value = '';
                    if (isMyTasks) {
                        this.refreshMyTasksData();
                    } else {
                        this.refreshData();
                    }
                    return;
                case 'custom':
                    return;
            }
            
            document.getElementById(prefix + 'FromDate').value = fromDate.toISOString().split('T')[0];
            document.getElementById(prefix + 'ToDate').value = toDate.toISOString().split('T')[0];
            
            if (isMyTasks) {
                this.refreshMyTasksData();
            } else {
                this.refreshData();
            }
        },
        
        applyDateFilter() {
            this.refreshData();
            UIManager.showNotification('Filter Applied', 'Tasks filtered successfully!');
        },
        
        applyMyTasksDateFilter() {
            this.refreshMyTasksData();
            UIManager.showNotification('Filter Applied', 'My Tasks filtered successfully!');
        },
        
        clearAllFilters() {
            // Clear search inputs
            document.getElementById('taskSearch').value = '';
            document.getElementById('myTasksSearch').value = '';
            
            // Reset time periods to "All Tasks"
            document.getElementById('timePeriod').value = 'all';
            document.getElementById('myTasksTimePeriod').value = 'all';
            
            // Clear date inputs
            document.getElementById('fromDate').value = '';
            document.getElementById('toDate').value = '';
            document.getElementById('myTasksFromDate').value = '';
            document.getElementById('myTasksToDate').value = '';
            
            // Hide filter panels
            document.getElementById('dateFilters').classList.remove('show');
            document.getElementById('myTasksDateFilters').classList.remove('show');
            
            // Update filter button text
            document.getElementById('toggleFilter').innerHTML = '<i class="fas fa-filter"></i> Show Filters';
            document.getElementById('toggleMyTasksFilter').innerHTML = '<i class="fas fa-filter"></i> Show Filters';
            
            // Refresh data
            this.refreshData();
            this.refreshMyTasksData();
            
            UIManager.showNotification('Filters Cleared', 'All filters have been cleared and data refreshed.');
        },
        
        _initializeDrawer() {
            const menuToggle = document.getElementById('menuToggle');
            const drawer = document.getElementById('sideDrawer');
            const overlay = document.getElementById('drawerOverlay');
            const drawerClose = document.getElementById('drawerClose');
            
            menuToggle.addEventListener('click', () => {
                drawer.classList.toggle('open');
                overlay.classList.toggle('show');
                menuToggle.classList.toggle('active');
                document.body.classList.toggle('lock-scroll');
            });
            
            overlay.addEventListener('click', () => {
                drawer.classList.remove('open');
                overlay.classList.remove('show');
                menuToggle.classList.remove('active');
                document.body.classList.remove('lock-scroll');
            });
            
            drawerClose.addEventListener('click', () => {
                drawer.classList.remove('open');
                overlay.classList.remove('show');
                menuToggle.classList.remove('active');
                document.body.classList.remove('lock-scroll');
            });

            document.querySelectorAll('.drawer-item[data-page]').forEach(i => {
                i.addEventListener('click', function(e) {
                    e.preventDefault();
                    Dashboard.navigateToPage(this.getAttribute('data-page'));
                    drawer.classList.remove('open');
                    overlay.classList.remove('show');
                    menuToggle.classList.remove('active');
                    document.body.classList.remove('lock-scroll');
                });
            });
        },
        
        navigateToPage(page) {
            this.currentPage = page;
            UIManager.showSection(page);
        },
        
        _setupEventListeners() {
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to logout?')) {
                    UIManager.showLoading(true);
                    setTimeout(() => {
                        UIManager.showLoading(false);
                        alert('Logged out successfully!');
                    }, 1500);
                }
            });
            
            // Filter toggle for dashboard
            document.getElementById('toggleFilter').addEventListener('click', function() {
                const f = document.getElementById('dateFilters');
                const v = f.classList.toggle('show');
                this.innerHTML = `<i class="fas fa-${v ? 'times' : 'filter'}"></i> ${v ? 'Hide' : 'Show'} Filters`;
            });
            
            // Filter toggle for my tasks
            document.getElementById('toggleMyTasksFilter').addEventListener('click', function() {
                const f = document.getElementById('myTasksDateFilters');
                const v = f.classList.toggle('show');
                this.innerHTML = `<i class="fas fa-${v ? 'times' : 'filter'}"></i> ${v ? 'Hide' : 'Show'} Filters`;
            });
            
            // Apply filter button for dashboard
            document.getElementById('applyFilter').addEventListener('click', () => {
                this.applyDateFilter();
            });
            
            // Apply filter button for my tasks
            document.getElementById('applyMyTasksFilter').addEventListener('click', () => {
                this.applyMyTasksDateFilter();
            });
            
            // Time period change for dashboard
            document.getElementById('timePeriod').addEventListener('change', function() {
                Dashboard._setDateRange(this.value);
                Dashboard._saveUserPreferences();
            });
            
            // Time period change for my tasks
            document.getElementById('myTasksTimePeriod').addEventListener('change', function() {
                Dashboard._setDateRange(this.value, true);
            });
            
            // Refresh data for dashboard - NOW CLEARS FILTERS
            document.getElementById('refreshData').addEventListener('click', function() {
                const btn = this;
                const o = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner spinner"></i> Refreshing...';
                btn.disabled = true;
                
                setTimeout(() => {
                    Dashboard.clearAllFilters();
                    btn.innerHTML = o;
                    btn.disabled = false;
                }, 1500);
            });
            
            // Search functionality for dashboard - INSIDE BUTTON
            document.getElementById('searchButtonInside').addEventListener('click', () => this.refreshData());
            document.getElementById('taskSearch').addEventListener('keyup', e => {
                if(e.key === 'Enter') this.refreshData();
            });
            
            // Search functionality for my tasks - INSIDE BUTTON
            document.getElementById('myTasksSearchButtonInside').addEventListener('click', () => this.refreshMyTasksData());
            document.getElementById('myTasksSearch').addEventListener('keyup', e => {
                if(e.key === 'Enter') this.refreshMyTasksData();
            });
            
            // Avatar upload - Auto close sidebar and open avatar modal
            document.getElementById('avatarUploadBtn').addEventListener('click', () => {
                // Close sidebar
                const drawer = document.getElementById('sideDrawer');
                const overlay = document.getElementById('drawerOverlay');
                const menuToggle = document.getElementById('menuToggle');
                
                drawer.classList.remove('open');
                overlay.classList.remove('show');
                menuToggle.classList.remove('active');
                document.body.classList.remove('lock-scroll');
                
                // Open avatar modal
                document.getElementById('avatarModal').style.display = 'flex';
            });
            
            // Avatar modal controls
            document.getElementById('closeAvatarModal').addEventListener('click', () => {
                document.getElementById('avatarModal').style.display = 'none';
            });
            
            document.getElementById('confirmAvatarSelection').addEventListener('click', () => {
                AvatarManager.saveAvatar();
                document.getElementById('avatarModal').style.display = 'none';
            });
            
            // WhatsApp button in sidebar
            document.getElementById('whatsappBtn').addEventListener('click', () => {
                const phoneNumber = '9071880185';
                const message = 'Hello! I need help with the Task Management Dashboard.';
                const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            });
            
            // WhatsApp button in profile section
            document.getElementById('profileWhatsappBtn').addEventListener('click', () => {
                const phoneNumber = '9071880185';
                const message = 'Hello! I need help with the Task Management Dashboard.';
                const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            });
            
            // Dark mode toggle - FIXED
            document.getElementById('darkModeToggle').addEventListener('change', function() {
                const newTheme = ThemeManager.toggleTheme();
                UIManager.showNotification('Theme Updated', `Dark mode ${newTheme === 'dark' ? 'enabled' : 'disabled'}`);
            });
            
            // Export buttons
            document.getElementById('exportTasks').addEventListener('click', () => {
                UIManager.showNotification('Export Started', 'Your tasks data is being prepared for download.');
            });
            
            document.getElementById('exportMyTasks').addEventListener('click', () => {
                UIManager.showNotification('Export Started', 'Your tasks data is being prepared for download.');
            });
            
            // Modal events
            document.getElementById('completedTasksCard').addEventListener('click', this.showCompletedTasks);
            document.getElementById('closeCompletedModal').addEventListener('click', () => {
                document.getElementById('completedTasksModal').style.display = 'none';
            });
            document.getElementById('closeCompletedModalBtn').addEventListener('click', () => {
                document.getElementById('completedTasksModal').style.display = 'none';
            });
            document.getElementById('toggleReceived').addEventListener('click', this.showPaymentReceivedTasks);
            document.getElementById('togglePending').addEventListener('click', this.showPaymentPendingTasks);
            document.getElementById('pendingTasksCard').addEventListener('click', this.showPendingTasks);
            document.getElementById('closePendingModal').addEventListener('click', () => {
                document.getElementById('pendingTasksModal').style.display = 'none';
            });
            document.getElementById('closePendingModalBtn').addEventListener('click', () => {
                document.getElementById('pendingTasksModal').style.display = 'none';
            });
            document.getElementById('reviewTasksCard').addEventListener('click', this.showReviewTasks);
            document.getElementById('closeReviewModal').addEventListener('click', () => {
                document.getElementById('reviewTasksModal').style.display = 'none';
            });
            document.getElementById('closeReviewModalBtn').addEventListener('click', () => {
                document.getElementById('reviewTasksModal').style.display = 'none';
            });
            document.getElementById('dismissModalNotice').addEventListener('click', () => {
                document.getElementById('modalPaymentNotice').style.display = 'none';
            });
            document.getElementById('selectAllPending').addEventListener('change', function() {
                BulkActions.selectAllTasks('pending', TaskManager.getTasksByStatus('pending'), this.checked);
            });
            document.getElementById('markPendingAsComplete').addEventListener('click', () => {
                BulkActions.markSelectedAsComplete('pending');
            });
            document.getElementById('clearPendingSelection').addEventListener('click', () => {
                BulkActions.clearSelection('pending');
            });
            document.getElementById('selectAllReview').addEventListener('change', function() {
                BulkActions.selectAllTasks('review', TaskManager.getTasksByStatus('in-review'), this.checked);
            });
            document.getElementById('markReviewAsComplete').addEventListener('click', () => {
                BulkActions.markSelectedAsComplete('review');
            });
            document.getElementById('clearReviewSelection').addEventListener('click', () => {
                BulkActions.clearSelection('review');
            });
        },
        
        _populateModalList(tasks, listId, noMsgId, totalId, status, bulkStatus = null) {
            const list = document.getElementById(listId);
            const noMsg = document.getElementById(noMsgId);
            const totalEl = document.getElementById(totalId);
            list.innerHTML = '';
            
            if(tasks.length === 0) {
                noMsg.style.display = 'flex';
                if(totalEl) totalEl.textContent = '₹0';
                return;
            }
            
            noMsg.style.display = 'none';
            let total = 0;
            
            tasks.forEach(t => {
                const e = parseInt(t.earnings.replace(/[₹,]/g, ''));
                total += e;
                
                const paymentInfo = status === 'completed' ? 
                    `<span class="payment-status payment-${t.paymentStatus}">${t.paymentStatus === 'received' ? `<i class="fas fa-check-circle"></i> Paid (${UIManager._formatDate(t.paymentDate)})` : '<i class="fas fa-clock"></i> Payment Pending'}</span>` :
                    `<span class="task-status status-${t.status.replace('-','') || 'pending'}">${t.status.charAt(0).toUpperCase() + t.status.slice(1)}</span>`;
                
                const checkbox = bulkStatus ? 
                    `<input type="checkbox" class="task-checkbox" id="task-${bulkStatus}-${t.id}" onchange="BulkActions.toggleTaskSelection(${t.id},'${bulkStatus}',this.checked)">` : '';
                
                list.innerHTML += `
                    <tr>
                        ${bulkStatus ? `<td>${checkbox}</td>` : ''}
                        <td>
                            <div style="font-weight:600">${t.name}</div>
                        </td>
                        <td>
                            <div class="customer-info">
                                <div class="customer-name">${t.customer.name}</div>
                                <div class="customer-email">${t.customer.email}</div>
                            </div>
                        </td>
                        <td>
                            <div class="timestamp">${UIManager._formatDate(t.startDate)}</div>
                        </td>
                        <td>
                            <div class="timestamp">${status === 'completed' ? UIManager._formatTime(t.lastUpdate) : t.lastUpdate}</div>
                        </td>
                        <td>
                            <div style="font-weight:600;color:var(--secondary)">${t.earnings}</div>
                        </td>
                        ${bulkStatus ? `<td>${paymentInfo}</td>` : `<td>${paymentInfo}</td>`}
                    </tr>
                `;
            });
            
            if(totalEl) totalEl.textContent = `₹${total.toLocaleString('en-IN')}`;
        },
        
        showCompletedTasks() {
            document.getElementById('completedTasksModal').style.display = 'flex';
            document.getElementById('modalPaymentNotice').style.display = 'none';
            Dashboard.showPaymentReceivedTasks();
        },
        
        showPaymentReceivedTasks() {
            const tasks = TaskManager.tasks.filter(t => t.status === 'completed' && t.paymentStatus === 'received');
            Dashboard._populateModalList(tasks, 'completedTasksList', 'noCompletedTasksMessage', null, 'completed');
            document.getElementById('modalPaymentNotice').style.display = 'none';
            document.getElementById('toggleReceived').classList.add('active');
            document.getElementById('togglePending').classList.remove('active');
        },
        
        showPaymentPendingTasks() {
            const tasks = TaskManager.tasks.filter(t => t.status === 'completed' && t.paymentStatus === 'pending');
            Dashboard._populateModalList(tasks, 'completedTasksList', 'noCompletedTasksMessage', null, 'completed');
            document.getElementById('modalPaymentNotice').style.display = 'block';
            document.getElementById('togglePending').classList.add('active');
            document.getElementById('toggleReceived').classList.remove('active');
        },
        
        showPendingTasks() {
            const tasks = TaskManager.getTasksByStatus('pending');
            Dashboard._populateModalList(tasks, 'pendingTasksList', 'noPendingTasksMessage', 'pendingTotalValue', 'pending', 'pending');
            BulkActions.clearSelection('pending');
            document.getElementById('pendingTasksModal').style.display = 'flex';
        },
        
        showReviewTasks() {
            const tasks = TaskManager.getTasksByStatus('in-review');
            Dashboard._populateModalList(tasks, 'reviewTasksList', 'noReviewTasksMessage', 'reviewTotalValue', 'in-review', 'review');
            BulkActions.clearSelection('review');
            document.getElementById('reviewTasksModal').style.display = 'flex';
        }
    };

    // Initialize the dashboard
    document.addEventListener('DOMContentLoaded', () => Dashboard.initialize());
</script>

</body>
    </html>
